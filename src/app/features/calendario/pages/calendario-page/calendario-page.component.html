<div class="flex justify-between items-center mb-6">
  <h2 class="text-xl font-bold text-gray-800">
    <span>üóìÔ∏è</span>
    Calendario Citas Medicas
  </h2>

</div>
<nz-calendar>

  <!-- ‚úÖ Eventos por d√≠a -->
  <ul *nzDateCell="let date" class="events">
    @for (event of getEventsForDate(date); track event.id) {
    <li (click)="openEvent(event)" class="event-item">
      <nz-badge [nzStatus]="getBadgeStatus(event.extendedProps.state)"
        [nzText]="event.title + ' - ' + event.extendedProps.veterinarie.full_name">
      </nz-badge>
    </li>
    }
  </ul>

  <!-- ‚úÖ Opcional: Datos por mes -->
  <ng-container *nzMonthCell="let month">
    @if (getEventsForDate(month).length > 0) {
    <div class="notes-month">
      <section>{{ getEventsForDate(month).length }}</section>
      <span>Citas</span>
    </div>
    }
  </ng-container>
</nz-calendar>

<!-- ‚úÖ DRAWER con el formulario/detalles -->
<nz-drawer [nzClosable]="true" [nzVisible]="visible()" nzPlacement="right" [nzTitle]="'Editar Cita'" [nzWidth]="500"
  (nzOnClose)="close()">

  <ng-container *nzDrawerContent>
    @if (selectedEvent(); as event) {
    <form nz-form [formGroup]="citaForm" (ngSubmit)="onSubmit()">

      <!-- ‚úÖ Informaci√≥n de la Mascota (Solo lectura) -->
      <nz-form-item>
        <nz-form-label [nzSpan]="24">Veterinario</nz-form-label>
        <nz-form-control [nzSpan]="24">
          <input nz-input [value]="event.extendedProps.veterinarie.full_name" [disabled]="true"
            nzPlaceHolder="Veterinario">
        </nz-form-control>
      </nz-form-item>


      <!-- ‚úÖ Mascota (Formulario deshabilitado) -->
      <nz-form-item>
        <nz-form-label [nzSpan]="24">Mascota</nz-form-label>
        <nz-form-control [nzSpan]="24">
          <input nz-input [value]="event.extendedProps.pet.name" [disabled]="true" nzPlaceHolder="Mascota">
        </nz-form-control>
      </nz-form-item>
      <!-- ‚úÖ Hora de Atenci√≥n (Deshabilitado) -->
      <nz-form-item>
        <nz-form-label [nzSpan]="24">Hora de Atenci√≥n</nz-form-label>
        <nz-form-control [nzSpan]="24">
          <input nz-input [value]="(event.start | date:'HH:mm') + ' - ' + (event.end | date:'HH:mm')" [disabled]="true">
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzSpan]="24">D√≠a</nz-form-label>
        <nz-form-control [nzSpan]="24">
          <input nz-input [value]="event.extendedProps.day" [disabled]="true">
        </nz-form-control>
      </nz-form-item>


      <!-- ‚úÖ Costo de la Cita (Deshabilitado) -->
      <nz-form-item>
        <nz-form-label [nzSpan]="24">Costo de la Cita</nz-form-label>
        <nz-form-control [nzSpan]="24">
          <input nz-input [value]="'S/. ' + event.extendedProps.amount" [disabled]="true">
        </nz-form-control>
      </nz-form-item>

      <!-- ‚úÖ ESTADO (Editable) -->
      <nz-form-item>
        <nz-form-label [nzSpan]="24" nzRequired>Estado</nz-form-label>
        <nz-form-control [nzSpan]="24" nzErrorTip="Seleccione un estado">
          <nz-select formControlName="state" nzPlaceHolder="Seleccione estado">
            <nz-option nzValue="pendiente" nzLabel="Pendiente"></nz-option>
            <nz-option nzValue="atendido" nzLabel="Atendido"></nz-option>
            <nz-option nzValue="cancelado" nzLabel="Cancelado"></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>

      <!-- ‚úÖ COSTO (Editable) -->
      <nz-form-item>
        <nz-form-label [nzSpan]="24" nzRequired>Costo (S/.)</nz-form-label>
        <nz-form-control [nzSpan]="24" nzErrorTip="Ingrese el costo">
          <nz-input-number formControlName="amount" [nzMin]="0" [nzStep]="10" [nzPrecision]="2" nzPlaceHolder="0.00"
            style="width: 100%">
          </nz-input-number>
        </nz-form-control>
      </nz-form-item>

      <!-- ‚úÖ RAZ√ìN (Editable) -->
      <nz-form-item>
        <nz-form-label [nzSpan]="24" nzRequired>Raz√≥n de la cita</nz-form-label>
        <nz-form-control [nzSpan]="24" nzErrorTip="Ingrese la raz√≥n">
          <textarea nz-input formControlName="reason" nzPlaceHolder="Descripci√≥n de la cita"
            [nzAutosize]="{ minRows: 3, maxRows: 5 }">
            </textarea>
        </nz-form-control>
      </nz-form-item>

      <!-- ‚úÖ NOTAS M√âDICAS (Editable) -->
      <nz-form-item>
        <nz-form-label [nzSpan]="24">Notas M√©dicas</nz-form-label>
        <nz-form-control [nzSpan]="24">
          <textarea nz-input formControlName="notes" nzPlaceHolder="Notas adicionales del veterinario"
            [nzAutosize]="{ minRows: 3, maxRows: 5 }">
            </textarea>
        </nz-form-control>
      </nz-form-item>

      <!-- ‚úÖ Botones -->
      <div class="form-actions">
        <button nz-button nzType="default" (click)="close()" type="button">
          Cancelar
        </button>
        <button nz-button nzType="primary" type="submit" [nzLoading]="loading()">
          Guardar Cambios
        </button>
      </div>

    </form>
    }
  </ng-container>
</nz-drawer>