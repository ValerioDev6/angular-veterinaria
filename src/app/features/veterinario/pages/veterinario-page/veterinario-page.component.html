<div class="flex justify-between items-center mb-6">
  <h1 class="text-2xl font-bold text-gray-800">
    <span>üë®üèª‚Äç‚öïÔ∏è</span>
    Gesti√≥n de Veterinarios
  </h1>
  <button nz-button nzType="primary" class="flex items-center bg-indigo-600 hover:bg-indigo-700">
    <nz-icon nzType="plus-circle" nzTheme="fill"></nz-icon>
    Nuevo Usuario
  </button>
</div>
<div class="bg-gray-50 p-4 rounded-md mb-6">
  <div class="flex flex-col md:flex-row items-center justify-between gap-4">
    <div class="w-full md:w-1/3">
      <nz-input-group [nzSuffix]="suffixIconSearch" class="w-full">
        <input type="text" nz-input placeholder="Buscar por nombre" [ngModel]="searchTerm()"
          (ngModelChange)="searchTerm.set($event)" (keyup.enter)="onSearch()" class="w-full" />
      </nz-input-group>
      <ng-template #suffixIconSearch>
        <span nz-icon nzType="search"></span>
      </ng-template>
    </div>

    <div class="flex gap-2">
      <button nz-button nzType="primary" nz-tooltip nzTooltipTitle="Refrescar datos" (click)="refreshData()"
        [nzGhost]="false" class="!bg-emerald-500 !border-emerald-500 hover:!bg-emerald-600 hover:!border-emerald-600">
        <span nz-icon nzType="sync" nzTheme="outline"></span>
      </button>

      <button nz-button nz-tooltip [nzGhost]="false" nzTooltipTitle="Exportar a PDF"
        class="flex items-center justify-center h-9 px-3 bg-red-500 hover:bg-red-600 text-white">
        <span nz-icon nzType="file-pdf" nzTheme="fill"></span>
      </button>

      <button nz-button nz-tooltip [nzGhost]="false" nzTooltipTitle="Exportar a Excel"
        class="flex items-center justify-center h-9 px-3 bg-green-700 hover:bg-green-800 text-white">
        <span nz-icon nzType="file-excel" nzTheme="fill"></span>
      </button>
    </div>
  </div>
</div>

<nz-table #basicTable [nzData]="veterinarios()" [nzLoading]="isLoading()" [nzPageSize]="limit()" [nzTotal]="total()"
  [nzFrontPagination]="false" (nzPageIndexChange)="pageChanged($event)" [nzPageSizeOptions]="[5, 10, 20]"
  (nzPageSizeChange)="changePageSize($event)" [nzShowSizeChanger]="true" [nzBordered]="true" [nzShowQuickJumper]="true">
  <thead>
    <tr>
      <th>Usuario</th>
      <th>Email</th>
      <th>Tel√©fono</th>
      <th>Documento</th>
      <th>Fecha Nacimiento</th>
      <th>Horarios</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    @for (user of basicTable.data; track user.id) {
    <tr>
      <td>
        <div class="flex items-center gap-2">
          <nz-avatar [nzText]="user.username.charAt(0)" [nzSize]="32" [nzSrc]="user.avatar"></nz-avatar>
          <span>{{ user.username }}</span>
        </div>
      </td>
      <td>{{ user.email }}</td>
      <td>{{ user.phone || "N/A" }}</td>
      <td>{{ user.n_documento ? user.type_documento + ': ' + user.n_documento : "N/A" }}</td>
      <td>{{ user.birthday | date : "dd/MM/yyyy" }}</td>
      <td>
        <button nz-button nzType="default" nzShape="circle" nz-popover nzPopoverTitle="Horarios"
          [nzPopoverContent]="scheduleContent">
          <nz-icon nzType="calendar" nzTheme="outline"></nz-icon>
        </button>
        <ng-template #scheduleContent>
          @if (user.schedules && user.schedules.length > 0) {
          <div class="max-h-64 overflow-auto">
            <nz-table [nzData]="user.schedules" [nzShowPagination]="false" nzSize="small">
              <thead>
                <tr>
                  <th>D√≠a</th>
                  <th>Inicio</th>
                  <th>Fin</th>
                </tr>
              </thead>
  <tbody>
    @for (schedule of user.schedules; track schedule.id) {
    <tr>
      <td>{{ schedule.day }}</td>
      <td>{{ schedule.start_time }}</td>
      <td>{{ schedule.end_time }}</td>
    </tr>
    }
  </tbody>
</nz-table>
</div>
} @else {
<p>No hay horarios disponibles</p>
}
</ng-template>
</td>
<td>
  <div class="flex gap-2">
    <button nz-button nzType="primary" nzShape="circle" [routerLink]="['/admin/veterinarios/', user.id]">
      <nz-icon nzType="edit" nzTheme="outline"></nz-icon>
    </button>
    <button nz-button nzType="primary" nzDanger nzShape="circle">
      <nz-icon nzType="delete" nzTheme="outline"></nz-icon>
    </button>
    <button (click)="redirectCreateUser()" nz-button nzType="default" nzShape="circle">
      <nz-icon nzType="plus" nzTheme="outline"></nz-icon>
    </button>
  </div>
</td>
</tr>
}
</tbody>
</nz-table>